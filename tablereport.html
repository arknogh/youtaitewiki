<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WikiTableAnalyzer - Interactive Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        
        @-webkit-keyframes spinner {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">WikiTableAnalyzer</h1>
            <p class="text-gray-600">Interactive dashboard for analyzing wiki table usage patterns</p>
        </header>

        <!-- Controls Section -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">Configuration</h2>
            
            <!-- Data Source Input -->
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="dataSource">
                    Data Source
                </label>
                <div class="flex space-x-2">
                    <select id="dataSource" class="shadow border rounded py-2 px-3 text-gray-700 w-full">
                        <option value="sample">Sample Data</option>
                        <option value="upload">Upload CSV</option>
                        <option value="generate">Generate New Data</option>
                    </select>
                    <button id="loadDataBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        Load
                    </button>
                </div>
            </div>
            
            <!-- File Upload (hidden initially) -->
            <div id="fileUploadSection" class="mb-4 hidden">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">
                    Upload CSV File
                </label>
                <input id="csvFile" type="file" accept=".csv" class="shadow border rounded py-2 px-3 text-gray-700 w-full">
            </div>
            
            <!-- Script Parameters (hidden initially) -->
            <div id="scriptParamsSection" class="mb-4 hidden">
                <h3 class="text-lg font-medium mb-3">Script Parameters</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="namespace">
                            Namespace
                        </label>
                        <input id="namespace" type="number" min="0" value="0" class="shadow border rounded py-2 px-3 text-gray-700 w-full">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="limit">
                            Page Limit
                        </label>
                        <input id="limit" type="number" min="1" class="shadow border rounded py-2 px-3 text-gray-700 w-full" placeholder="No limit">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="startPage">
                            Start Page
                        </label>
                        <input id="startPage" type="text" class="shadow border rounded py-2 px-3 text-gray-700 w-full" placeholder="Start from beginning">
                    </div>
                </div>
                <div class="mt-4">
                    <button id="generateDataBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                        Generate Data
                    </button>
                    <p class="text-sm text-gray-500 mt-2">Note: This would typically run a Pywikibot script server-side. In this demo, it will generate mock data.</p>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="hidden">
            <div class="flex justify-center items-center mb-8">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
                <span class="ml-3 text-gray-700">Processing data...</span>
            </div>
        </div>

        <!-- Data Summary Section -->
        <div id="dataSummary" class="bg-white rounded-lg shadow p-6 mb-8 hidden">
            <h2 class="text-xl font-semibold mb-4">Summary</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h3 class="text-lg font-medium text-blue-800">Pages Analyzed</h3>
                    <p class="text-3xl font-bold text-blue-600" id="totalPages">0</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <h3 class="text-lg font-medium text-green-800">Infobox Templates</h3>
                    <p class="text-3xl font-bold text-green-600" id="totalInfoboxes">0</p>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                    <h3 class="text-lg font-medium text-purple-800">Table Structures</h3>
                    <p class="text-3xl font-bold text-purple-600" id="totalTables">0</p>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div id="chartsSection" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Chart 1: Infobox Types -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-xl font-semibold mb-4">Infobox Types</h2>
                    <div class="h-64">
                        <canvas id="infoboxChart"></canvas>
                    </div>
                </div>
                
                <!-- Chart 2: Table Types -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-xl font-semibold mb-4">Table Structure Types</h2>
                    <div class="h-64">
                        <canvas id="tableChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table Section -->
        <div id="dataTableSection" class="bg-white rounded-lg shadow p-6 mb-8 hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Page Details</h2>
                <div class="flex space-x-2">
                    <input id="tableSearch" type="text" placeholder="Search pages..." class="shadow border rounded py-2 px-3 text-gray-700">
                    <select id="tableFilter" class="shadow border rounded py-2 px-3 text-gray-700">
                        <option value="all">All Pages</option>
                        <option value="infobox_character">Infobox Character</option>
                        <option value="infobox_template">Other Infobox Templates</option>
                        <option value="infobox_class">Infobox Class</option>
                        <option value="article_table">Article Table</option>
                        <option value="other_table">Other Tables</option>
                        <option value="no_table">No Tables</option>
                    </select>
                    <button id="exportCsvBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                        <i class="fas fa-download mr-1"></i> Export CSV
                    </button>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Page Title</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Infobox Character</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Other Infobox</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Infobox Class</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Article Table</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Other Table</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Table rows will be inserted here -->
                    </tbody>
                </table>
            </div>
            <div class="mt-4 flex justify-between items-center">
                <div class="text-sm text-gray-700">
                    Showing <span id="shownRows">0</span> of <span id="totalRows">0</span> pages
                </div>
                <div class="flex space-x-2">
                    <button id="prevPageBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded" disabled>
                        Previous
                    </button>
                    <span id="paginationInfo" class="py-2 px-4">Page 1</span>
                    <button id="nextPageBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded" disabled>
                        Next
                    </button>
                </div>
            </div>
        </div>

        <!-- Instructions Section -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">Instructions</h2>
            <div class="space-y-4">
                <div>
                    <h3 class="text-lg font-medium">Getting Started</h3>
                    <p class="text-gray-700">This dashboard helps you analyze the usage of tables and infoboxes across your wiki.</p>
                </div>
                <div>
                    <h3 class="text-lg font-medium">Usage</h3>
                    <ol class="list-decimal list-inside text-gray-700 space-y-2">
                        <li>Select a data source (Sample Data, Upload CSV, or Generate New)</li>
                        <li>If using "Generate New", configure the parameters for the wiki scan</li>
                        <li>Use the dashboard to analyze the distribution of table types</li>
                        <li>Filter and search the page table to find specific patterns</li>
                        <li>Export the data as CSV for further analysis</li>
                    </ol>
                </div>
                <div>
                    <h3 class="text-lg font-medium">About Table Types</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li><strong>Infobox Character Template:</strong> Pages using <code>{{Infobox character}}</code></li>
                        <li><strong>Other Infobox Templates:</strong> Pages using other infobox templates</li>
                        <li><strong>Infobox Class:</strong> Pages with tables using <code>class="infobox"</code></li>
                        <li><strong>Article Table:</strong> Pages with tables using <code>class="article-table"</code></li>
                        <li><strong>Other Table:</strong> Pages with other wiki tables using <code>{|</code> syntax</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        const rowsPerPage = 10;
        
        // Sample data for demonstration
        const sampleData = [
            {title: "Character1", has_infobox_character_template: true, has_infobox_template: false, has_infobox_class: false, has_article_table_class: false, has_other_table: false},
            {title: "Character2", has_infobox_character_template: true, has_infobox_template: false, has_infobox_class: false, has_article_table_class: false, has_other_table: false},
            {title: "Character3", has_infobox_character_template: false, has_infobox_template: false, has_infobox_class: true, has_article_table_class: false, has_other_table: false},
            {title: "Character4", has_infobox_character_template: false, has_infobox_template: true, has_infobox_class: false, has_article_table_class: false, has_other_table: false},
            {title: "ChallengePage", has_infobox_character_template: false, has_infobox_template: false, has_infobox_class: false, has_article_table_class: true, has_other_table: false},
            {title: "EventPage", has_infobox_character_template: false, has_infobox_template: false, has_infobox_class: false, has_article_table_class: true, has_other_table: false},
            {title: "GroupPage", has_infobox_character_template: false, has_infobox_template: false, has_infobox_class: false, has_article_table_class: false, has_other_table: true},
            {title: "InfoPage", has_infobox_character_template: false, has_infobox_template: false, has_infobox_class: false, has_article_table_class: false, has_other_table: false},
            {title: "Tutorial", has_infobox_character_template: true, has_infobox_template: false, has_infobox_class: false, has_article_table_class: false, has_other_table: false},
            {title: "AboutPage", has_infobox_character_template: false, has_infobox_template: false, has_infobox_class: false, has_article_table_class: false, has_other_table: false},
            {title: "AshePage", has_infobox_character_template: false, has_infobox_template: false, has_infobox_class: true, has_article_table_class: false, has_other_table: false},
            {title: "BelphegorPage", has_infobox_character_template: false, has_infobox_template: false, has_infobox_class: true, has_article_table_class: false, has_other_table: false},
            {title: "NekonPage", has_infobox_character_template: false, has_infobox_template: false, has_infobox_class: false, has_article_table_class: true, has_other_table: false},
            {title: "KunjiPage", has_infobox_character_template: true, has_infobox_template: false, has_infobox_class: false, has_article_table_class: false, has_other_table: false},
            {title: "DangoPage", has_infobox_character_template: true, has_infobox_template: false, has_infobox_class: false, has_article_table_class: false, has_other_table: false}
        ];
        
        // Mock generation of random data (simulates what would be returned from pywikibot)
        function generateMockData(count = 50) {
            const characterNames = ["Aerie", "Kunji", "Dango", "Ashe", "Belphegor", "Nekon0", "KL", "Miku-tan", "Cherry", "Shadow", 
                                 "Rion", "Yuuto", "Kimmy", "Len", "Akira", "Hikaru", "Sora", "Yuki", "Hana", "Tsubaki"];
            const data = [];
            
            for (let i = 0; i < count; i++) {
                // For character pages (about 60% of pages), use character templates or classes
                if (Math.random() < 0.6) {
                    const name = characterNames[Math.floor(Math.random() * characterNames.length)];
                    const pageType = Math.random();
                    if (pageType < 0.33) {
                        // Use infobox_character template
                        data.push({
                            title: `${name}${Math.random() < 0.3 ? " (YT)" : ""}`,
                            has_infobox_character_template: true,
                            has_infobox_template: false,
                            has_infobox_class: false,
                            has_article_table_class: false,
                            has_other_table: false
                        });
                    } else if (pageType < 0.66) {
                        // Use infobox class
                        data.push({
                            title: `${name}${Math.random() < 0.3 ? " (NND)" : ""}`,
                            has_infobox_character_template: false,
                            has_infobox_template: false,
                            has_infobox_class: true,
                            has_article_table_class: false,
                            has_other_table: false
                        });
                    } else {
                        // Use article-table class
                        data.push({
                            title: `${name}${Math.random() < 0.3 ? " (male)" : ""}`,
                            has_infobox_character_template: false,
                            has_infobox_template: false,
                            has_infobox_class: false,
                            has_article_table_class: true,
                            has_other_table: false
                        });
                    }
                } 
                // For other pages (about 40%), use other structures or no tables
                else {
                    const pageTypes = ["Event", "Challenge", "Group", "Album", "Song", "Guide", "Category", "List"];
                    const pageType = pageTypes[Math.floor(Math.random() * pageTypes.length)];
                    const tableType = Math.random();
                    
                    if (tableType < 0.25) {
                        // Use other infobox template
                        data.push({
                            title: `${pageType}:${Math.floor(Math.random() * 100)}`,
                            has_infobox_character_template: false,
                            has_infobox_template: true,
                            has_infobox_class: false,
                            has_article_table_class: false,
                            has_other_table: false
                        });
                    } else if (tableType < 0.5) {
                        // Use article-table
                        data.push({
                            title: `${pageType}:${Math.floor(Math.random() * 100)}`,
                            has_infobox_character_template: false,
                            has_infobox_template: false,
                            has_infobox_class: false,
                            has_article_table_class: true,
                            has_other_table: false
                        });
                    } else if (tableType < 0.75) {
                        // Use other table
                        data.push({
                            title: `${pageType}:${Math.floor(Math.random() * 100)}`,
                            has_infobox_character_template: false,
                            has_infobox_template: false,
                            has_infobox_class: false,
                            has_article_table_class: false,
                            has_other_table: true
                        });
                    } else {
                        // No tables
                        data.push({
                            title: `${pageType}:${Math.floor(Math.random() * 100)}`,
                            has_infobox_character_template: false,
                            has_infobox_template: false,
                            has_infobox_class: false,
                            has_article_table_class: false,
                            has_other_table: false
                        });
                    }
                }
            }
            
            return data;
        }
        
        // Initialize elements
        document.addEventListener('DOMContentLoaded', function() {
            // Setup data source change handler
            document.getElementById('dataSource').addEventListener('change', function() {
                const source = this.value;
                document.getElementById('fileUploadSection').classList.add('hidden');
                document.getElementById('scriptParamsSection').classList.add('hidden');
                
                if (source === 'upload') {
                    document.getElementById('fileUploadSection').classList.remove('hidden');
                } else if (source === 'generate') {
                    document.getElementById('scriptParamsSection').classList.remove('hidden');
                }
            });
            
            // Setup load data button
            document.getElementById('loadDataBtn').addEventListener('click', function() {
                const source = document.getElementById('dataSource').value;
                
                if (source === 'sample') {
                    loadData(sampleData);
                } else if (source === 'upload') {
                    const fileInput = document.getElementById('csvFile');
                    if (fileInput.files.length > 0) {
                        handleFileUpload(fileInput.files[0]);
                    } else {
                        alert('Please select a CSV file first.');
                    }
                } else if (source === 'generate') {
                    showLoading();
                    // In a real application, this would call a server-side script
                    // For this demo, we'll generate mock data after a delay
                    setTimeout(() => {
                        const count = parseInt(document.getElementById('limit').value) || 50;
                        const data = generateMockData(count);
                        loadData(data);
                    }, 1500);
                }
            });
            
            // Setup generate data button
            document.getElementById('generateDataBtn').addEventListener('click', function() {
                showLoading();
                // In a real application, this would call a server-side script
                // For this demo, we'll generate mock data after a delay
                setTimeout(() => {
                    const count = parseInt(document.getElementById('limit').value) || 50;
                    const data = generateMockData(count);
                    loadData(data);
                }, 1500);
            });
            
            // Setup export CSV button
            document.getElementById('exportCsvBtn').addEventListener('click', function() {
                exportToCsv();
            });
            
            // Setup table search
            document.getElementById('tableSearch').addEventListener('input', function() {
                filterTable();
            });
            
            // Setup table filter
            document.getElementById('tableFilter').addEventListener('change', function() {
                filterTable();
            });
            
            // Setup pagination
            document.getElementById('prevPageBtn').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    displayTablePage();
                }
            });
            
            document.getElementById('nextPageBtn').addEventListener('click', function() {
                const maxPage = Math.ceil(filteredData.length / rowsPerPage);
                if (currentPage < maxPage) {
                    currentPage++;
                    displayTablePage();
                }
            });
        });
        
        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
            document.getElementById('dataSummary').classList.add('hidden');
            document.getElementById('chartsSection').classList.add('hidden');
            document.getElementById('dataTableSection').classList.add('hidden');
        }
        
        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
            document.getElementById('dataSummary').classList.remove('hidden');
            document.getElementById('chartsSection').classList.remove('hidden');
            document.getElementById('dataTableSection').classList.remove('hidden');
        }
        
        function handleFileUpload(file) {
            showLoading();
            
            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                complete: function(results) {
                    // Convert string boolean values to actual booleans if needed
                    const processedData = results.data.map(row => {
                        const processedRow = {...row};
                        for (const key in processedRow) {
                            if (processedRow[key] === 'true') processedRow[key] = true;
                            if (processedRow[key] === 'false') processedRow[key] = false;
                        }
                        return processedRow;
                    });
                    
                    loadData(processedData);
                },
                error: function(error) {
                    hideLoading();
                    alert('Error parsing CSV: ' + error);
                }
            });
        }
        
        function loadData(data) {
            allData = data;
            filteredData = [...data];
            currentPage = 1;
            
            updateSummary();
            createCharts();
            displayTablePage();
            
            hideLoading();
        }
        
        function updateSummary() {
            // Update total counts
            document.getElementById('totalPages').textContent = allData.length;
            
            const infoboxCharCount = allData.filter(item => item.has_infobox_character_template).length;
            const infoboxTemplateCount = allData.filter(item => item.has_infobox_template).length;
            const infoboxCount = infoboxCharCount + infoboxTemplateCount;
            
            const infoboxClassCount = allData.filter(item => item.has_infobox_class).length;
            const articleTableCount = allData.filter(item => item.has_article_table_class).length;
            const otherTableCount = allData.filter(item => item.has_other_table).length;
            const tableCount = infoboxClassCount + articleTableCount + otherTableCount;
            
            document.getElementById('totalInfoboxes').textContent = infoboxCount;
            document.getElementById('totalTables').textContent = tableCount;
        }
        
        function createCharts() {
            // Calculate data for charts
            const infoboxCharCount = allData.filter(item => item.has_infobox_character_template).length;
            const infoboxTemplateCount = allData.filter(item => item.has_infobox_template).length;
            const infoboxClassCount = allData.filter(item => item.has_infobox_class).length;
            const articleTableCount = allData.filter(item => item.has_article_table_class).length;
            const otherTableCount = allData.filter(item => item.has_other_table).length;
            
            // Calculate pages with no tables/infoboxes
            const noTableCount = allData.filter(item => 
                !item.has_infobox_character_template && 
                !item.has_infobox_template && 
                !item.has_infobox_class && 
                !item.has_article_table_class && 
                !item.has_other_table
            ).length;
            
            // Create or update infobox chart
            const infoboxCtx = document.getElementById('infoboxChart').getContext('2d');
            if (window.infoboxChart) {
                window.infoboxChart.destroy();
            }
            
            window.infoboxChart = new Chart(infoboxCtx, {
                type: 'pie',
                data: {
                    labels: ['Infobox Character', 'Other Infobox Templates', 'Infobox Class', 'No Infobox'],
                    datasets: [{
                        data: [infoboxCharCount, infoboxTemplateCount, infoboxClassCount, 
                               allData.length - (infoboxCharCount + infoboxTemplateCount + infoboxClassCount)],
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(201, 203, 207, 0.7)'
                        ],
                        borderColor: [
                            'rgb(54, 162, 235)',
                            'rgb(75, 192, 192)',
                            'rgb(153, 102, 255)',
                            'rgb(201, 203, 207)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
            
            // Create or update table chart
            const tableCtx = document.getElementById('tableChart').getContext('2d');
            if (window.tableChart) {
                window.tableChart.destroy();
            }
          }
            
  window.tableChart = new Chart(tableCtx, {
    type: 'pie',
    data: {
        labels: ['Infobox Class', 'Article Table', 'Other Tables', 'No Tables'],
        datasets: [{
            data: [infoboxClassCount, articleTableCount, otherTableCount, noTableCount],
            backgroundColor: [
                'rgba(153, 102, 255, 0.7)',
                'rgba(255, 159, 64, 0.7)',
                'rgba(255, 99, 132, 0.7)',
                'rgba(201, 203, 207, 0.7)'
            ],
            borderColor: [
                'rgb(153, 102, 255)',
                'rgb(255, 159, 64)',
                'rgb(255, 99, 132)',
                'rgb(201, 203, 207)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'right',
            }
        }
    }
});
} // end of createCharts function

function filterTable() {
    const searchTerm = document.getElementById('tableSearch').value.toLowerCase();
    const filterType = document.getElementById('tableFilter').value;
    
    filteredData = allData.filter(item => {
        // Apply search filter
        const matchesSearch = searchTerm === '' || item.title.toLowerCase().includes(searchTerm);
        
        // Apply type filter
        let matchesType = true;
        if (filterType === 'infobox_character') {
            matchesType = item.has_infobox_character_template;
        } else if (filterType === 'infobox_template') {
            matchesType = item.has_infobox_template;
        } else if (filterType === 'infobox_class') {
            matchesType = item.has_infobox_class;
        } else if (filterType === 'article_table') {
            matchesType = item.has_article_table_class;
        } else if (filterType === 'other_table') {
            matchesType = item.has_other_table;
        } else if (filterType === 'no_table') {
            matchesType = !item.has_infobox_character_template && 
                          !item.has_infobox_template && 
                          !item.has_infobox_class && 
                          !item.has_article_table_class && 
                          !item.has_other_table;
        }
        
        return matchesSearch && matchesType;
    });
    
    // Reset to first page
    currentPage = 1;
    displayTablePage();
}

function displayTablePage() {
    const tableBody = document.getElementById('dataTableBody');
    tableBody.innerHTML = '';
    
    const startIdx = (currentPage - 1) * rowsPerPage;
    const endIdx = Math.min(startIdx + rowsPerPage, filteredData.length);
    
    const pageData = filteredData.slice(startIdx, endIdx);
    
    pageData.forEach(item => {
        const row = document.createElement('tr');
        
        // Page title
        const titleCell = document.createElement('td');
        titleCell.className = 'px-6 py-4 whitespace-nowrap';
        titleCell.textContent = item.title;
        row.appendChild(titleCell);
        
        // Infobox Character
        const infoboxCharCell = createStatusCell(item.has_infobox_character_template);
        row.appendChild(infoboxCharCell);
        
        // Other Infobox
        const infoboxCell = createStatusCell(item.has_infobox_template);
        row.appendChild(infoboxCell);
        
        // Infobox Class
        const infoboxClassCell = createStatusCell(item.has_infobox_class);
        row.appendChild(infoboxClassCell);
        
        // Article Table
        const articleTableCell = createStatusCell(item.has_article_table_class);
        row.appendChild(articleTableCell);
        
        // Other Table
        const otherTableCell = createStatusCell(item.has_other_table);
        row.appendChild(otherTableCell);
        
        tableBody.appendChild(row);
    });
    
    // Update pagination info
    document.getElementById('shownRows').textContent = pageData.length;
    document.getElementById('totalRows').textContent = filteredData.length;
    document.getElementById('paginationInfo').textContent = `Page ${currentPage} of ${Math.max(1, Math.ceil(filteredData.length / rowsPerPage))}`;
    
    // Update pagination buttons
    document.getElementById('prevPageBtn').disabled = currentPage <= 1;
    document.getElementById('nextPageBtn').disabled = currentPage >= Math.ceil(filteredData.length / rowsPerPage);
}

function createStatusCell(value) {
    const cell = document.createElement('td');
    cell.className = 'px-6 py-4 whitespace-nowrap text-center';
    
    if (value) {
        cell.innerHTML = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><i class="fas fa-check mr-1"></i>Yes</span>';
    } else {
        cell.innerHTML = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"><i class="fas fa-times mr-1"></i>No</span>';
    }
    
    return cell;
}

function exportToCsv() {
    // Prepare CSV content
    let csvContent = "data:text/csv;charset=utf-8,";
    
    // Add headers
    csvContent += "Page Title,Infobox Character,Other Infobox,Infobox Class,Article Table,Other Table\n";
    
    // Add data rows
    filteredData.forEach(item => {
        csvContent += `"${item.title}",${item.has_infobox_character_template},${item.has_infobox_template},${item.has_infobox_class},${item.has_article_table_class},${item.has_other_table}\n`;
    });
    
    // Create download link
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", `wiki_table_analysis_${new Date().toISOString().split('T')[0]}.csv`);
    document.body.appendChild(link);
    
    // Download the file
    link.click();
    
    // Clean up
    document.body.removeChild(link);
}
